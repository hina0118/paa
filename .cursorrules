# PAA Project: Development & Review Rules

## 1. Review Priority System (重要)
AIがコードを提案・レビューする際は、以下の優先度ラベルを意識してください。

- **[P0: Critical]**: 動作不能、セキュリティ、致命的なバグ、データ破損の恐れ。
  - AIの行動: 即座に指摘し、修正されるまで徹底的に議論する。
- **[P1: Important]**: パフォーマンス低下、設計の明らかなミス、将来的な負債。
  - AIの行動: 指摘はするが、ユーザーが「後で直す」と言ったら受け入れる。
- **[P2: Nitpick]**: コーディングスタイル、変数名、リファクタリング、Fast Refreshの警告。
  - AIの行動: 1回だけ提案する。ユーザーが無視したら二度と同じ指摘を繰り返さない。

## 2. Technical Strategy (Rust / Tauri)
- **Error Handling**: `unwrap()` を避け、`Result` または `Option` を使用すること。
- **Sync Logic**: Gmail APIからの取得は `nextPageToken` をベースとしたループ処理を厳守すること。
- **AI Extraction**: 商品名のパースは `src-tauri/src/ai_extractor.rs`（予定）に集約し、フロントエンドに複雑なロジックを持たせない。

## 3. Communication Strategy
- レビューがループしていると感じた場合、AIは自ら「どの優先度レベルの議論か」を確認すること。
- ユーザーが「先に進めて」と言った場合、P1/P2の指摘をすべて取り下げ、現在の実装を完遂すること。
- 修正案を出す際は、ファイル全体を書き換えるのではなく、変更が必要な最小単位のコードブロックを提示すること。

# GitHub PR対応のワークフロー
1. 修正を開始する前に、必ず GitHub MCP を使用して最新の PR レビューコメントと CI のステータスを確認すること。
2. 全ての指摘事項に対して、関連するファイルを横断的に修正すること。
3. 修正が完了したら、GitHub CLI (`gh`) を使用してコミットとプッシュを行うこと。
4. 指摘が残っている、または CI が失敗している場合は、完了とみなさず、再度原因を分析して修正をループすること。
5. レビューへの対応を行った場合、同一PR上で再度copilotへレビュー依頼を行うこと。レビュー依頼を出したらレビュー結果が表示されるまでPRを監視すること
6. 優先度の高いレビュー指摘、CIのエラーがなくなるまでPRを監視し繰り返し対応すること

# Custom Commands
/plan_pr:
  description: 特定のPRの内容を分析し、対応計画を作成する
  parameters:
    pr_number:
      type: integer
      description: PRの番号
  example:
    /plan_pr 59
  instructions:
    - 未対応コメントを確認して対応計画を立てる
/do_plan:
  description: 対応計画を実行する
  example:
    /do_plan
  instructions:
    - チャット上で提示された対応計画を順次実行する
/commit_plan:
  description: 対応内容をコミットする
  example:
    /commit_plan
  instructions:
    - チャット上で対応した変更をコミットする
/resolve_comment:
  description: 対応したコメントを解決済みにする
  example:
    /resolve_comment
  instructions:
    - graphQLを使用してPR上の対応したコメントを解決済みにする
/ci_plan:
  description: CI成功のためチェックする
  example:
    /ci_plan
  instructions:
    - 全体のlint,format,test,coverageを実行する
    - フロント、バックエンドともに確認する
    - CIの設定に沿って結果を確認する
    - コマンド実行中に作成した一時ファイルは削除する
    - タイムアウトを検知したら該当処理を再チェックする
    - ファイルロックがあった場合、cleanしてから実行する
/push_plan:
  description: 対応内容をプッシュする
  example:
    /push_plan
  instructions:
    - チャット上で対応した変更をコミットする
    - 対応内容をプッシュする
    - プッシュ後に対応PR上でレビュー依頼を出す
    - 一時的に作成していたファイルは削除する
