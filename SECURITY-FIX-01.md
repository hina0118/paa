# セキュリティ修正 #1: 機密情報のログ出力対策

## 📋 概要
PR #21で指摘された機密情報のログ出力問題を修正しました。

## 🔒 実施した対策

### 1. Base64データの内容ログ出力を削除
**ファイル**: `src-tauri/src/gmail.rs:388-390`

**変更前**:
```rust
log::debug!("Attempting to decode base64, input length: {}, first 50 chars: {:?}",
    data.len(),
    &data.chars().take(50).collect::<String>()
);
```

**変更後**:
```rust
log::debug!("Attempting to decode base64, input length: {}", data.len());
```

**理由**: Base64データの最初の50文字にはメール本文の一部が含まれる可能性があり、機密情報漏洩のリスクがあった。

### 2. 本番環境でのデバッグログ無効化
**ファイル**: `src-tauri/src/lib.rs:443-462`

**追加内容**:
```rust
// リリースビルドではWarnレベル以上、デバッグビルドではInfoレベル以上のログを出力
// これにより、本番環境で機密情報を含む可能性のあるデバッグログを防ぐ
#[cfg(debug_assertions)]
let default_level = log::LevelFilter::Info;
#[cfg(not(debug_assertions))]
let default_level = log::LevelFilter::Warn;
```

**効果**:
- **デバッグビルド**: Info以上のログを出力（開発時のデバッグに必要）
- **リリースビルド**: Warn以上のログのみ出力（Debug/Infoログは出力されない）

### 3. セキュリティガイドラインの追加
**ファイル**: `src-tauri/src/gmail.rs:1-5`

モジュールの先頭にセキュリティガイドラインを追加し、今後の開発で同様の問題が発生しないようドキュメント化しました。

**内容**:
- 機密情報のログ出力禁止
- デバッグログの制限
- メトリクスのみの出力許可
- 本番環境のログレベル説明

## ✅ 検証結果

### コンパイルチェック
```
cargo check
✓ コンパイル成功（警告は既存のもので今回の修正とは無関係）
```

### 残存するログの安全性確認
以下のログは**メトリクス情報のみ**で機密情報を含まないため安全:
- `log::info!("Found text/plain body: {} chars", content.len())` - 文字数のみ
- `log::debug!("Message {} extracted: plain={} bytes, html={} bytes", ...)` - バイト数のみ
- `log::debug!("Successfully decoded {} bytes -> {} chars", ...)` - サイズのみ

## 🔐 セキュリティレベル向上

| 項目 | 修正前 | 修正後 |
|------|--------|--------|
| Base64データの内容 | ❌ 最初の50文字を出力 | ✅ 出力しない |
| 本番環境のデバッグログ | ❌ 出力される | ✅ 完全に無効化 |
| セキュリティガイドライン | ❌ なし | ✅ ドキュメント化 |
| 開発者への注意喚起 | ❌ なし | ✅ コメントで明示 |

## 📝 今後の推奨事項

1. **定期的なログレビュー**: 新機能追加時にログ出力内容を確認
2. **コードレビュー**: PRレビュー時にログ出力をチェック
3. **静的解析**: 機密情報のログ出力を検出するlintルールの追加検討
4. **環境変数**: 必要に応じて`RUST_LOG`環境変数でログレベルをオーバーライド可能

## 🎯 関連する脅威の排除状況

✅ **高脅威度 #1**: 機密情報のログ出力 → **完全に解決**
- Base64データの内容出力を削除
- 本番環境でデバッグログを無効化
- セキュリティガイドラインを文書化
