# データのバックアップ・復元

PAA のメタデータ（AI解析済み商品データ、画像キャッシュ、店舗設定など）をバックアップ・復元する機能の使い方です。

## バックアップ対象

以下のテーブルと画像ファイルがエクスポートされます。

| テーブル       | 内容                                                             |
| -------------- | ---------------------------------------------------------------- |
| images         | 商品画像のメタデータ（item_name_normalized と file_name の対応） |
| shop_settings  | 店舗設定（送信元アドレス、パーサータイプなど）                   |
| product_master | AI（Gemini）解析済みの商品情報（メーカー、シリーズ、スケール等） |
| emails         | 取得済みメール（message_id、本文、差出人、件名など）             |

画像ファイルは `app_data_dir/images/` に保存されている実体が ZIP 内の `images/` フォルダに含まれます。

## 使い方

1. サイドバーから「データのバックアップ」をクリック
2. **データのバックアップ**ボタンでエクスポート、**データの復元**ボタンでインポート

### エクスポート（バックアップ）

1. 「データのバックアップ」ボタンをクリック
2. 保存先を選択するダイアログが表示される
3. ファイル名を指定して保存（デフォルト: `paa_export_YYYYMMDD_HHmmss.zip`）
4. ZIP ファイルが作成される

### インポート（復元）

1. 「データの復元」ボタンをクリック
2. 確認ダイアログで「Ok」をクリック
3. バックアップ ZIP を選択
4. データが現在の DB にマージされる（INSERT OR IGNORE のため、既存データと競合する行はスキップ）

## ZIP 内構成

```
paa_export_YYYYMMDD_HHmmss.zip
├── manifest.json       # バージョン・エクスポート日時
├── images.json         # images テーブル
├── shop_settings.json  # shop_settings テーブル
├── product_master.json # product_master テーブル
├── emails.json         # emails テーブル
└── images/             # 画像ファイル
    ├── xxx.jpg
    └── yyy.png
```

## 注意事項

- DB をリセットしても、バックアップからメタデータを復元することで AI 解析済みの商品データや画像キャッシュを維持できます
- インポート時、UNIQUE 制約で競合する行は既存データが維持されます
- 画像ファイルは同名が存在する場合はスキップ（既存を維持）
